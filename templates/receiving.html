{% extends "base.html" %}

{% block title %}Receiving Stats{% endblock %}

{% block content %}

<style>
  .week-nav{display:flex;align-items:center;justify-content:center;gap:14px;margin:20px 0 14px}
  .week-nav .arrow{font-size:22px;text-decoration:none;padding:2px 10px;border:1px solid #ccc;border-radius:8px}
  .week-nav .arrow.disabled{opacity:.35;pointer-events:none;border-color:transparent}
  .week-nav .wk{font-weight:600}
</style>

<div class="week-nav">
  {% if prev_week %}
    <a class="arrow" href="{{ url_for('show_receiving_stats', league=league, season=season, week=prev_week) }}">&larr; Prev</a>
  {% else %}<span class="arrow disabled">&larr;</span>{% endif %}
  <span class="wk">Week {{ week.replace('week_', '') }}</span>
  {% if next_week %}
    <a class="arrow" href="{{ url_for('show_receiving_stats', league=league, season=season, week=next_week) }}">Next &rarr;</a>
  {% else %}<span class="arrow disabled">&rarr;</span>{% endif %}
</div>

<h1>Receiving Stats</h1>

<div style="margin-bottom: 20px; font-size: 1.2em; font-weight: bold;">
  Season: {{ season | replace('season_', '') }} &nbsp; &nbsp; Week: {{ week | replace('week_', '') }}
</div>

{% if players %}
<table id="statsTable">
  <thead>
    <tr>
      <th onclick="sortTable(0)">Team<span id="arrow-0" class="arrow"></span></th>
      <th onclick="sortTable(1)">#<span id="arrow-1" class="arrow"></span></th>        <!-- NEW -->
      <th onclick="sortTable(2)">Pos<span id="arrow-2" class="arrow"></span></th>      <!-- NEW -->
      <th onclick="sortTable(3)">Player<span id="arrow-3" class="arrow"></span></th>
      <th onclick="sortTable(4)">Receptions<span id="arrow-4" class="arrow"></span></th>
      <th onclick="sortTable(5)">Yards<span id="arrow-5" class="arrow"></span></th>
      <th onclick="sortTable(6)">TDs<span id="arrow-6" class="arrow"></span></th>
      <th onclick="sortTable(7)">Drops<span id="arrow-7" class="arrow"></span></th>
      <th onclick="sortTable(8)">Longest<span id="arrow-8" class="arrow"></span></th>
      <th onclick="sortTable(9)">YAC<span id="arrow-9" class="arrow"></span></th>
      <th onclick="sortTable(10)">YPC<span id="arrow-10" class="arrow"></span></th>
      <th onclick="sortTable(11)">Catch %<span id="arrow-11" class="arrow"></span></th>
    </tr>
  </thead>
  <tbody>
    {% for p in players %}
    <tr>
      <td>{{ p.team or "Unknown" }}</td>
      <td>{{ jersey_num(p) }}</td>                                    {# NEW #}
      <td>{{ p.position or p.pos or '' }}</td>                        {# NEW #}
      <td>{{ p.playerName or p.fullName or p.name }}</td>
      <td>{{ p.recCatches or p.receptions or p.rec or 0 }}</td>
      <td>{{ p.recYds or p.receivingYds or p.yards or p.yds or 0 }}</td>
      <td>{{ p.recTDs or p.recTds or p.td or p.tds or 0 }}</td>
      <td>{{ p.recDrops or p.drops or 0 }}</td>
      <td>{{ p.recLongest or p.long or p.longest or 0 }}</td>
      <td>{{ p.recYdsAfterCatch or p.yac or 0 }}</td>
      <td>{{ "%.1f"|format((p.recYdsPerCatch or p.ypc or 0)) }}</td>
      <td>{{ "%.1f"|format((p.recCatchPct or p.catchPct or 0)) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No receiving stats available.</p>
{% endif %}

<script>
let sortState = {
    column: null,
    ascending: false
};

function sortTable(columnIndex) {
    const table = document.getElementById("statsTable");
    const tbody = table.tBodies[0];
    const rows = Array.from(tbody.rows);

    const isNumeric = !isNaN(rows[0].cells[columnIndex].innerText.trim());

    if (sortState.column === columnIndex) {
        sortState.ascending = !sortState.ascending;
    } else {
        sortState.column = columnIndex;
        sortState.ascending = false;
    }

    rows.sort((a, b) => {
        const aText = a.cells[columnIndex].innerText.trim();
        const bText = b.cells[columnIndex].innerText.trim();

        if (isNumeric) {
            const aVal = parseFloat(aText);
            const bVal = parseFloat(bText);
            return sortState.ascending ? aVal - bVal : bVal - aVal;
        } else {
            return sortState.ascending
                ? aText.localeCompare(bText)
                : bText.localeCompare(aText);
        }
    });

    document.querySelectorAll(".arrow").forEach(el => el.innerText = "");
    document.getElementById("arrow-" + columnIndex).innerText = sortState.ascending ? "▲" : "▼";

    rows.forEach(row => tbody.appendChild(row));
}
</script>
{% endblock %}
